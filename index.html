<!DOCTYPE html>

<html lang="en">

<head>
<title>Satellite images gallery</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8">
<link rel="stylesheet" href="/styles/default.css">
</head>
<body style="text-align: center; padding-left:5%; padding-right:5%; padding-top:5%">

<img id="random-image" width="35%" align="right" alt="HRPT sample image">

<p>Welcome to the satellite images gallery landing page.</p>

<p>The image you see on this page has been randomly picked from the gallery, which you can access in its entirety using the link below. While the images in the gallery use lossy webp compression, the total file size can still be a concern for some people with data caps. Instead of sharing a direct link to the gallery, please link this page instead.</p>

<p style="font-size: xx-large"><a href="gallery.html">> Enter <</a></p>

<p>The current size of the gallery is <span id="folderSize">calculating...</span></p>

<script>
  fetch('images/samples/names.txt')
    .then(response => response.text())
    .then(data => {
      var images = data.trim().split('\n').map(filename => filename.trim());
      var randomIndex = Math.floor(Math.random() * images.length);
      var randomImage = images[randomIndex];

      var img = document.getElementById('random-image');
      img.src = "images/samples/" + randomImage;
    })
    .catch(error => {
      console.error(error);
    });
</script>

<script>
  function getFolderSize(folderPath, callback) {
      fetch(folderPath)
          .then(response => response.text())
          .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, 'text/html');
              const links = doc.querySelectorAll('a');

              let totalSize = 0;
              let fileCount = 0;

              links.forEach(link => {
                  const href = link.getAttribute('href');
                  if (!href.startsWith('../')) {
                      fileCount++;
                      fetch(folderPath + href)
                          .then(response => response.blob())
                          .then(blob => {
                              totalSize += blob.size;
                              fileCount--;

                              if (fileCount === 0) {
                                  callback(totalSize);
                              }
                          });
                  }
              });
          })
          .catch(error => {
              console.error("Error:", error);
          });
  }

  function formatSizeUnits(bytes) {
      const units = ['B', 'KB', 'MB', 'GB', 'TB'];
      let index = 0;

      while (bytes >= 1024 && index < units.length - 1) {
          bytes /= 1024;
          index++;
      }

      return Math.round(bytes, 2) + ' ' + units[index];
  }

  const folderPath = '/images/samples/';
  getFolderSize(folderPath, function (sizeInBytes) {
      const formattedSize = formatSizeUnits(sizeInBytes);
      document.getElementById('folderSize').textContent = formattedSize;
  });
</script>


</body>
</html>